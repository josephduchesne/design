---
layout: default
title: roslaunch markup design
permalink: articles/150_roslaunch_markup_design.html
abstract:
  This article describes the rationale for a roslaunch markup language
published: true
author: '[Joseph Duchesne](https://github.com/josephduchesne)'
categories: Overview
---

{:toc}

# {{ page.title }}

## Scope, purpose, and design goals:

### Why a markup language?:

- more guardrails than a python file:
    - XSD or DTD validation
    - no infinite loops, other issues reducing stability
- easier to understand/learn
- harder to shoot yourself in the foot
- Some people will expect/want one since ros1 has one
- It's easier to audit, review and debug markup driven functional units, than code (compare an ansible playbook vrs. a bash script for example)
- This separates "business logic" from "application logic" of launching nodes in a way that the python launch scripts easily allow developers to muddle.

### What is this document for?
- To start gathering feedback about what ros2 launch markdown look like
- To propose firm up initial implementation plans so that work can begin on a prototype

### Markup launchfile goals
- It is my hope that the two launchfile definitions would be fully interoperable. You should be able to include markup launchfiles in python ones and vise-versea.
- It should be automatic, or easy to add markup support to any `LaunchDescriptionEntity`
- If successful, writing markup based launchfiles may become more commonplace, and python program launchfiles may become primarily used for:
    - Creating new LaunchDescriptionEntitys to handle generic cases
    - Users who love python and/or hate XML
    - Handling special cases that involve very specific logic, checks

## Markup Language:
- XML?:
    - used in ros1 (community familiarity)
    - very flexible
    - somewhat verbose
    - portable 
    - Widely used in ROS ecosystem (parsers already installed)
    - XSD validation allows for easy sanity checking
- Yaml:
    - concise (which may mean easier to read/write)
    - Some implementation specific foibles
    - Widely used in ROS ecosystem (parsers already installed)
- Both?:
    - It may lead to a stronger markup abstraction layer, allowing other markup languages in the future 
    - This may fragment the community a bit
    - More options may lead to bugs due to less familiarity when editing filetype B when you are used to A
    - This would likely more work
- Others?:
    - I don't have any others that I would personally propose, but I'm curious what others may have in mind
- Custom?:
    - This seems antithetical to the design philosophy of ROS2
    - See "why ros2" 

I would like to propose XML as a single initial target, with no initial expectation of supporting another markup language.

We should have sufficient work cut out for us with just **two** different, but hopefully complementary ways of defining launchfiles.

## Loading/namespacing:
ros2's python launch system is very extensible.
This means that classes will have to be loaded from many packages and python namespaces. How should markup handle that?

### A registry?
- pluginlib for example has an explicit registry of ROS packages, what types of plugins they provide etc. Maybe the markup language parser could leverage a similar system?

For example in package.xml:
```xml
    ...
    <export>
        <!-- either autogenerated or explicit xml mappings -->
        <launch plugin="${prefix}/launch_extensions.xml" />
    </export>
```

This could allow for core packages to exist in the same global namespace if we wanted, and could easily allow us to define short names for markup, rather than whatever the Python class happens to be. 

This could result in something like:
```xml
<Launch>
  <Node id="server" package="demo_nodes_cpp" node_executable="add_two_ints_server" output="screen" />
  <Node id="client" package="demo_nodes_cpp" node_executable="add_two_ints_client" output="screen" />
  <RequiredProcess target="client" />
</Launch>
```

### Explicit namespacing?

Parse the namespace:

```xml
<launch:LaunchDescription>
  <launch_ros.actions:Node id="server" package="demo_nodes_cpp" node_executable="add_two_ints_server" output="screen" />
  <launch_ros.actions:Node id="client" package="demo_nodes_cpp" node_executable="add_two_ints_client" output="screen" />
  <launch_ros.actions:RequiredProcessEventHandler target="client" />
</launch:LaunchDescription>
```

And/or leverage xmlns:

```xml
<LaunchDescription xmlns="launch"  xmlns:action="launch.action" xmlns:ros="launch_ros.action">
  <ros:Node id="server" package="demo_nodes_cpp" node_executable="add_two_ints_server" output="screen" />
  <ros:Node id="client" package="demo_nodes_cpp" node_executable="add_two_ints_client" output="screen" />
  <action:RequiredProcessEventHandler target="#client" />
</LaunchDescription>
```

This could have some sanity checking (ensure descendant class of `LaunchDescriptionEntity` for example).


## Security:
Should we consider launchfiles applications? (e.g. only run +x modded launchfiles etc.)

If a launchfile can execute arbitrary programs, maybe?

Are there other security related concerns we should add here?

I do not propose directly addressing this issue in a prototype, but it's worth raising the issue early in case it must impact design.

## References:
It seems fairly important based on my reading of the ros2 launch design doc that actions, events, etc. should be able to reference each other in their definitions.

How do we want to do this in markup?

### IDs?
Coming from HTML, being able to simply reference IDs.
Example:

```xml
    <Node id="server" package="foo" node_executable="bar" />
    <LaunchShutdownHandler target="my_node" />
```

This isn't very flexible, but is at least very easy to implement (registry+lookup?)

This does raise the question about how to handle things outside of the current file?

Maybe we shouldn't worry about that?

### Selectors?
CSS and JQuery made selectors popular. Borrowing their syntax may add a lot of complexity, but it would also allow for some of the flexibility offered by JS

A hypothetical example:

```xml
    <GroupAction id="my_group" />
        <-- This hypothetical Event shuts down the launchfile when
            any node with the executable tag "bar" exits -->
        <LaunchShutdownHandler target="nextAll([node_executable=bar)" />
        <Node node_name="required_a" package="foo" node_executable="bar" />
        <Node node_name="required_b" package="foo" node_executable="bar" />
    </GroupAction>
```

Selectors could handle simple lookups (by property for example, by adjacency, or a combination).

## What's next

If this document gets regular feedback and new ideas are coming in, I would like to keep updating it.

Once there appears to be consensus, or it becomes apparent that no consensus is to be had, or this document receives no feedback, I hope to draft a prototype.

That may be functional, or it may just be translation of some community launchfiles into the proposed format in preparation for a functioning prototype. I am hoping that the markdown parser integration can be worked into the amusingly pathed ros2/launch/launch/launch in such a way that things descending from it require minimal changes (ros2/launch_ros etc.).
